\chapter{Case 2}
%\label{chap:case2}
%\addcontentsline{toc}{chapter}{Case 2}

\begin{lemma}
    \label{lmm:three_dvd_gcd_of_dvd_a_of_dvd_b}
    \lean{three_dvd_gcd_of_dvd_a_of_dvd_b}
    \leanok
    Let $a, b, c \in \N$. \\
    Let $3 \divides a$ and $3 \divides b$. \\
    Let $a ^ 3 + b ^ 3 = c ^ 3$. \\\\
    Then $3 \divides gcd(a,b,c)$.
\end{lemma}
\begin{proof}
    \leanok
    Since $3 \divides a^3 + b^3 = c^3$, then $3 \divides c$. \\
    Then $3 \divides gcd(a,b,c)$.
\end{proof}

\begin{lemma}
    \label{lmm:three_dvd_gcd_of_dvd_a_of_dvd_c}
    \lean{three_dvd_gcd_of_dvd_a_of_dvd_c}
    \leanok
    %\uses{}
    Let $a, b, c \in \N$. \\
    Let $3 \divides a$ and $3 \divides c$. \\
    Let $a ^ 3 + b ^ 3 = c ^ 3$. \\\\
    Then $3 \divides gcd(a,b,c)$.
\end{lemma}
\begin{proof}
    \leanok
    Since $3 \divides c^3 - a^3 = b^3$, then $3 \divides b$. \\
    Then $3 \divides gcd(a,b,c)$.
\end{proof}

\begin{lemma}
    \label{lmm:three_dvd_gcd_of_dvd_b_of_dvd_c}
    \lean{three_dvd_gcd_of_dvd_b_of_dvd_c}
    \leanok
    Let $a, b, c \in \N$. \\
    Let $3 \divides b$ and $3 \divides c$. \\
    Let $a ^ 3 + b ^ 3 = c ^ 3$. \\\\
    Then $3 \divides gcd(a,b,c)$.
\end{lemma}
\begin{proof}
    \leanok
    Since $3 \divides c^3 - b^3 = a^3$, then $3 \divides a$. \\
    Then $3 \divides gcd(a,b,c)$.
\end{proof}

% Informalise fermatLastTheoremThree_of_three_dvd_only_c from FLT3.lean file.
\begin{theorem}
    \label{thm:fermatLastTheoremThree_of_three_dvd_only_c}
    \lean{fermatLastTheoremThree_of_three_dvd_only_c}
    \leanok
    To prove \Cref{thm:fermatLastTheoremThree}, it suffices to prove that
    $$\forall a, b, c \in \Z, \text{ if } c \neq 0 \text{ and } 3 \notdivides a \text{ and }
    3 \notdivides b \text{ and } 3 \divides c \text{ and } \gcd(a,b)=1,
    \text{ then } a^3 + b^3 \neq c^3.$$
\end{theorem}
\begin{proof}
    \leanok
    \uses{
    lmm:fermatLastTheoremWith_of_fermatLastTheoremWith_coprime,
    thm:fermatLastTheoremThree_case_1,
    lmm:three_dvd_gcd_of_dvd_a_of_dvd_b,
    lmm:three_dvd_gcd_of_dvd_a_of_dvd_c,
    lmm:three_dvd_gcd_of_dvd_b_of_dvd_c
    }
    % Assume by contradiction that $\exists a,b,c \in \N \smallsetminus \set{0}$
    % such that $a^3 + b^3 = c^3$. \\
    % By \Cref{thm:fermatLastTheoremWith_of_fermatLastTheoremWith_coprime}
    % we can assume $\gcd(a,b,c)=1$. \\
    % By \Cref{thm:fermatLastTheoremThree_case_1} we can assume $3 \divides a  b  c$
    % from which it follows that $3 \divides a \lor 3 \divides b \lor 3 \divides c$.\\
    % Analysing the three cases:
    % \begin{itemize}
    %     \item Case $3 \divides a$. Let $a'=-c$, $b'=b$, $c'=-a$,
    %     then $a'\neq 0 \land b'\neq 0 \land c' \neq 0$.
    %     Then $3 \notdivides -c = a'$ since otherwise by \Cref{lmm:three_dvd_gcd_of_dvd_a_of_dvd_c}
    %     we have that $3 \divides gcd(a,b,c)$. Analogously,
    %     by \Cref{lmm:three_dvd_gcd_of_dvd_a_of_dvd_b} $3 \notdivides b = b'$.
    %     Moreover $3 \divides -a = c'$


    %     \item Case $3 \divides b$. then $3 \divides a^3$ and $3 \divides c^3$.
    %     By \Cref{lmm:three_dvd_gcd_of_dvd_a_of_dvd_b} and \Cref{lmm:three_dvd_gcd_of_dvd_b_of_dvd_c},
    %     we have $3 \divides gcd(a,b,c)$.
    %     \item Case $3 \divides c$. then $3 \divides a^3$ and $3 \divides b^3$.
    %     By \Cref{lmm:three_dvd_gcd_of_dvd_a_of_dvd_c} and \Cref{lmm:three_dvd_gcd_of_dvd_b_of_dvd_c},
    %     we have $3 \divides gcd(a,b,c)$.
    %\end{itemize}
\end{proof}

\begin{definition}[Solution']
    \label{def:Solution1}
    \lean{Solution'}
    \leanok
    Let $a, b, c \in \cc{O}_K$ such that $c \neq 0$ and $\gcd(a,b)=1$.\\
    Let $\lambda \notdivides a$, $\lambda \notdivides b$ and $\lambda \divides c$. \\\\
    A $\boldsymbol{solution'}$ is a tuple $S'=(a, b, c, u)$
    satisfying the equation $a^3 + b^3 = u c^3.$
\end{definition}

\begin{definition}[Solution]
    \label{def:Solution}
    \lean{Solution}
    \leanok
    Let $a, b, c \in \cc{O}_K$ such that $c \neq 0$ and $\gcd(a,b)=1$.\\
    Let $\lambda \notdivides a$, $\lambda \notdivides b$, $\lambda \divides c$ and
    $\lambda^2 \divides a+b$. \\\\
    A $\boldsymbol{solution}$ is a tuple $S=(a, b, c, u)$
    satisfying the equation $a^3 + b^3 = u c^3$.
\end{definition}

\begin{definition}[Multiplicity of Solution']
    \label{def:Solution1_Multiplicity}
    \lean{Solution'.multiplicity}
    \leanok
    \uses{def:Solution1}
    Let $S'=(a, b, c, u)$ be a $solution'$. \\\\
    The $\boldsymbol{multiplicity}$ of $S'$ is the largest $n \in \N$ such that
    $\lambda^n \divides c$.
\end{definition}

\begin{definition}[Multiplicity of Solution]
    \label{def:Solution_Multiplicity}
    \lean{Solution.multiplicity}
    \leanok
    \uses{def:Solution}
    Let $S=(a, b, c, u)$ be a $solution$. \\\\
    The $\boldsymbol{multiplicity}$ of $S$ is the largest $n \in \N$ such that
    $\lambda^n \divides c$.
\end{definition}

\begin{definition}[Minimal Solution]
    \label{def:Solution_Minimal}
    \lean{Solution.isMinimal}
    \leanok
    \uses{def:Solution}
    Let $S=(a, b, c, u)$ be a $solution$. \\\\
    We say that $S$ is $\boldsymbol{minimal}$ if for all solutions $S_1=(a_1,b_1,c_1,u_1)$,
    the $multiplicity$ of $S$ is less than or equal to the $multiplicity$ of $S_1$.
\end{definition}

\begin{lemma}
    \label{lmm:Solution1.multiplicity_lambda_c_finite}
    \lean{Solution'.multiplicity_lambda_c_finite}
    \leanok
    \uses{def:Solution1}
    Let $S'=(a, b, c, u)$ be a $solution'$. \\\\
    Then the multiplicity of $S'$ is finite.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_not_unit}
    It directly follows from \Cref{lmm:lambda_not_unit}.
\end{proof}

\begin{lemma}
    \label{lmm:exists_minimal}
    \lean{Solution.exists_minimal}
    \leanok
    \uses{def:Solution, def:Solution_Minimal}
    Let $S$ be a $solution$ with multiplicity $n$. \\\\
    Then there is a minimal solution $S_1$.
\end{lemma}
\begin{proof}
    \leanok
    Straightforward since $n \in \N$ and $\N$ is well-ordered.
\end{proof}

\begin{lemma}
    \label{lmm:a_cube_b_cube_same_congr}
    \lean{a_cube_b_cube_same_congr}
    \leanok
    \uses{def:Solution1}
    Let $S'=(a, b, c, u)$ be a $solution'$. \\\\
    Then $\lambda^4 \divides a^3 - 1 \land \lambda^4 \divides b^3 + 1$ or
    $\lambda^4 \divides a^3 + 1 \land \lambda^4 \divides b^3 - 1$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_pow_four_dvd_cube_sub_one_or_add_one_of_lambda_not_dvd,
    lmm:lambda_not_dvd_two}
    Since $\lambda \notdivides a$, then
    $\lambda^4 \divides a^3 - 1 \lor \lambda^4 \divides a^3 + 1$ by
    \Cref{lmm:lambda_pow_four_dvd_cube_sub_one_or_add_one_of_lambda_not_dvd}. \\
    Since $\lambda \notdivides b$, then
    $\lambda^4 \divides b^3 - 1 \lor \lambda^4 \divides b^3 + 1$ by
    \Cref{lmm:lambda_pow_four_dvd_cube_sub_one_or_add_one_of_lambda_not_dvd}. \\
    We proceed by analysing each case:
    \begin{itemize}
        \item Case $\lambda^4 \divides a^3 - 1 \land \lambda^4 \divides b^3 - 1$.
        Since $\lambda \divides c$ we have that $\lambda \divides c^3-(a^3-1)-(b^3-1) = 2$,
        which is absurd by \Cref{lmm:lambda_not_dvd_two}.
        \item Case $\lambda^4 \divides a^3 + 1 \land \lambda^4 \divides b^3 + 1$.
        Since $\lambda \divides c$ we have that $\lambda \divides (a^3-1)+(b^3-1)-c^3 = 2$,
        which is absurd by \Cref{lmm:lambda_not_dvd_two}.
        \item Case $\lambda^4 \divides a^3 - 1 \land \lambda^4 \divides b^3 + 1$. Trivial.
        \item Case $\lambda^4 \divides a^3 + 1 \land \lambda^4 \divides b^3 - 1$. Trivial.
    \end{itemize}
\end{proof}

\begin{lemma}
    \label{lmm:lambda_pow_four_dvd_c_cube}
    \lean{lambda_pow_four_dvd_c_cube}
    \leanok
    \uses{def:Solution1}
    Let $S'=(a, b, c, u)$ be a $solution'$. \\\\
    Then $\lambda^4 \divides c^3$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:a_cube_b_cube_same_congr}
    Apply \Cref{lmm:a_cube_b_cube_same_congr} and then compute each case.
\end{proof}

\begin{lemma}
    \label{lmm:lambda_pow_two_dvd_c}
    \lean{lambda_pow_two_dvd_c}
    \leanok
    \uses{def:Solution1}
    Let $S'=(a, b, c, u)$ be a $solution'$. \\\\
    Then $\lambda^2 \divides c$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:multiplicity_lambda_c_finite,
    lmm:lambda_pow_four_dvd_c_cube,
    lambda_prime}
    Trivial applying \Cref{lmm:lambda_pow_four_dvd_c_cube}.
\end{proof}

\begin{lemma}
    \label{lmm:Solution1_two_le_multiplicity}
    \lean{Solution'.two_le_multiplicity}
    \leanok
    \uses{def:Solution1}
    Let $S'=(a, b, c, u)$ be a $solution'$ with multiplicity $n$.\\\\
    Then $2 \leq n$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_pow_two_dvd_c}
    It directly follows from \Cref{lmm:lambda_pow_two_dvd_c}.
\end{proof}

\begin{lemma}
    \label{lmm:Solution_two_le_multiplicity}
    \lean{Solution.two_le_multiplicity}
    \leanok
    \uses{def:Solution}
    Let $S=(a, b, c, u)$ be a $solution$ with multiplicity $n$.\\\\
    Then $2 \leq n$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:Solution1_two_le_multiplicity}
    It directly follows from \Cref{lmm:Solution1_two_le_multiplicity}.
\end{proof}

\begin{lemma}
    \label{lmm:cube_add_cube_eq_mul}
    \lean{cube_add_cube_eq_mul}
    \leanok
    \uses{def:Solution1}
    Let $S'=(a, b, c, u)$ be a $solution'$.\\\\
    Then $a^3 + b^3 = (a + b) (a + \eta b)  (a + \eta^2 b)$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:toInteger_cube_eq_one, lmm:toInteger_eval_cyclo}
    Straightforward calculation using \Cref{lmm:toInteger_cube_eq_one}
    and \Cref{lmm:toInteger_eval_cyclo}.
\end{proof}

\begin{lemma}
    \label{lmm:lambda_sq_dvd_or_dvd_or_dvd}
    \lean{lambda_sq_dvd_or_dvd_or_dvd}
    \leanok
    \uses{def:Solution1}
    Let $S'=(a, b, c, u)$ be a $solution'$.\\\\
    Then $\lambda^2 \divides a + b \lor \lambda^2 \divides a +
    \eta  b \lor \lambda^2 \divides a + \eta^2  b$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_pow_two_dvd_c, lmm:cube_add_cube_eq_mul,
    lmm:zeta_sub_one_prime1}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:ex_dvd_a_add_b}
    \lean{ex_dvd_a_add_b}
    \leanok
    \uses{def:Solution1}
    Let $S'=(a, b, c, u)$ be a $solution'$.\\\\
    Then $\exists a_1,b_1 \in \cc{O}_k$ such that $S_1=(a_1,b_1,c,u)$ is a $solution$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_sq_dvd_or_dvd_or_dvd, lmm:toInteger_cube_eq_one}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:exists_Solution_of_Solution1}
    \lean{exists_Solution_of_Solution'}
    \leanok
    \uses{def:Solution1, def:Solution}
    Let $S$ be a $solution$ with multiplicity $n$.\\\\
    Then there is a $solution'\text{ }S'$ with multiplicity $n$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:ex_dvd_a_add_b}
    Let $S=(a,b,c,u)$. Let $a', b'$ be the units given by \Cref{lmm:ex_dvd_a_add_b}.
    Then $S'=(a',b',c,u)$ is a $solution'$.
\end{proof}

\begin{lemma}
    \label{lmm:a_add_eta_b}
    \lean{Solution.a_add_eta_b}
    \leanok
    \uses{def:Solution}
    Let $S=(a, b, c, u)$ be a $solution$.\\\\
    Then $a + \eta  b = (a + b) + \lambda  b$.
\end{lemma}
\begin{proof}
    \leanok
    Trivial calculation.
\end{proof}

\begin{lemma}
    \label{lmm:lambda_dvd_a_add_eta_mul_b}
    \lean{Solution.lambda_dvd_a_add_eta_mul_b}
    \leanok
    \uses{def:Solution}
    Let $S=(a, b, c, u)$ be a $solution$.\\\\
    Then $\lambda \divides a + \eta  b$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:a_add_eta_b}
    Trivial since $\lambda \divides a+b$.
\end{proof}

\begin{lemma}
    \label{lmm:lambda_dvd_a_add_eta_sq_mul_b}
    \lean{Solution.lambda_dvd_a_add_eta_sq_mul_b}
    \leanok
    \uses{def:Solution}
    Let $S=(a, b, c, u)$ be a $solution$.\\\\
    Then $\lambda \divides a + \eta^2  b$.
\end{lemma}
\begin{proof}
    \leanok
    Since $\lambda \divides a+b$, then
    $\lambda \divides (a + b) + \lambda^2  b + 2  \lambda  b
    = a + \eta^2  b$.
\end{proof}

\begin{lemma}
    \label{lmm:lambda_sq_not_dvd_a_add_eta_mul_b}
    \lean{Solution.lambda_sq_not_dvd_a_add_eta_mul_b}
    \leanok
    \uses{def:Solution}
    Let $S=(a, b, c, u)$ be a $solution$.\\\\
    Then $\lambda^2 \notdivides a + \eta  b$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:a_add_eta_b, lmm:lambda_ne_zero}
    By contradiction using \Cref{lmm:a_add_eta_b}, if $\lambda^2 \divides a +\eta b = a + b + \lambda  b$,
    since $\lambda^2 \divides a+b$, then $\lambda^2 \divides \lambda  b$, from which it follows
    that $\lambda \divides b$, which is absurd.
\end{proof}

\begin{lemma}
    \label{lmm:lambda_sq_not_dvd_a_add_eta_sq_mul_b}
    \lean{Solution.lambda_sq_not_dvd_a_add_eta_sq_mul_b}
    \leanok
    \uses{def:Solution}
    Let $S=(a, b, c, u)$ be a $solution$.\\\\
    Then $\lambda^2 \notdivides a + \eta^2  b$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_ne_zero, lmm:toInteger_eval_cyclo}
    By contradiction using \Cref{lmm:toInteger_eval_cyclo},
    if $\lambda^2 \divides a +\eta^2 b = a + b -b + \eta^2  b$,
    since $\lambda^2 \divides a+b$, then $\lambda^2 \divides b  (\eta^2 -1)
    = \lambda  b  (\eta + 1)$. Since $\lambda \notdivides b$, then
    $\lambda \divides \eta+1 = \lambda +2$, then $\lambda \divides 2$ which is absurd.
\end{proof}

\begin{lemma}
    \label{lmm:eta_add_one_inv}
    \lean{Solution.eta_add_one_inv}
    \leanok
    \uses{def:Solution}
    Let $S=(a, b, c, u)$ be a $solution$.\\\\
    Then $(\eta + 1)  (-\eta) = 1$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:toInteger_eval_cyclo}
    Trivial calculation using \Cref{lmm:toInteger_eval_cyclo}.
\end{proof}

\begin{lemma}
    \label{lmm:associated_of_dvd_a_add_b_of_dvd_a_add_eta_mul_b}
    \lean{Solution.associated_of_dvd_a_add_b_of_dvd_a_add_eta_mul_b}
    \leanok
    \uses{def:Solution}
    Let $S=(a, b, c, u)$ be a $solution$.\\
    Let $p \in \cc{O}_K$ be a prime such that $p \divides a+b$
    and $p \divides a+\eta  b$.\\\\
    Then $p$ is associated with $\lambda$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_prime}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:associated_of_dvd_a_add_b_of_dvd_a_add_eta_sq__mul_b}
    \lean{Solution.associated_of_dvd_a_add_b_of_dvd_a_add_eta_sq__mul_b}
    \leanok
    \uses{def:Solution}
    Let $S=(a, b, c, u)$ be a $solution$.\\
    Let $p \in \cc{O}_K$ be a prime such that $p \divides a+b$
    and $p \divides a+\eta^2  b$.\\\\
    Then $p$ is associated with $\lambda$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_prime, lmm:eta_add_one_inv, lmm:toInteger_cube_eq_one}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:associated_of_dvd_a_add_eta_mul_b_of_dvd_a_add_eta_sq__mul_b}
    \lean{Solution.associated_of_dvd_a_add_eta_mul_b_of_dvd_a_add_eta_sq__mul_b}
    \leanok
    \uses{def:Solution}
    Let $S=(a, b, c, u)$ be a $solution$.\\
    Let $p \in \cc{O}_K$ be a prime such that $p \divides a+\eta  b$
    and $p \divides a+\eta^2  b$.\\\\
    Then $p$ is associated with $\lambda$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_prime}
    % TODO
\end{proof}

\begin{definition}[$x,y,z,w$]
    \label{def:Solution_x_y_z_w}
    %\lean{}
    \leanok
    \uses{def:Solution}
    Let $S=(a, b, c, u)$ be a $solution$.\\\\
    We define $x \in \cc{O}_K$ such that $a + b = \lambda^{3n-2}  x$.\\
    We define $y \in \cc{O}_K$ such that $a + \eta  b = \lambda  y$.\\
    We define $z \in \cc{O}_K$ such that $a + \eta^2  b = \lambda  z$.\\
    We define $w \in \cc{O}_K$ such that $c = \lambda^n  w$.
\end{definition}

\begin{lemma}
    \label{lmm:lambda_not_dvd_y}
    \lean{Solution.lambda_not_dvd_y}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\lambda \notdivides y$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_sq_not_dvd_a_add_eta_mul_b}
    By contradiction, if $\lambda \divides y$, then $\lambda^2 \divides \lambda  y
    = a + \eta b$ which is absurd by \Cref{lmm:lambda_sq_not_dvd_a_add_eta_mul_b}.
\end{proof}

\begin{lemma}
    \label{lmm:lambda_not_dvd_z}
    \lean{Solution.lambda_not_dvd_z}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\lambda \notdivides z$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_sq_not_dvd_a_add_eta_sq_mul_b}
    By contradiction, if $\lambda \divides z$, then $\lambda^2 \divides \lambda  z
    = a + \eta^2 b$ which is absurd by \Cref{lmm:lambda_sq_not_dvd_a_add_eta_sq_mul_b}.
\end{proof}

\begin{lemma}
    \label{lmm:lambda_pow_dvd_a_add_b}
    \lean{Solution.lambda_pow_dvd_a_add_b}
    \leanok
    \uses{def:Solution}
    Let $S=(a, b, c, u)$ be a $solution$ with multiplicity $n$.\\\\
    Then $\lambda^{3n -2} \divides a + b$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:cube_add_cube_eq_mul, lmm:lambda_prime,
    lmm:lambda_not_dvd_z, lmm:lambda_not_dvd_y, lmm:Solution_two_le_multiplicity,
    lmm:lambda_ne_zero}
    By definition of multiplicity $\lambda^n \divides c$. Since $u$ is a unit, then using \Cref{lmm:cube_add_cube_eq_mul}
    $\lambda^{3n} \divides u  c^3 = a^3 + b^3
    = (a+b)  (a + \eta  b)  (a + \eta^2  b)
    = (a+b)(\lambda y)(\lambda z)$.
    Then using \Cref{lmm:lambda_not_dvd_y} and \Cref{lmm:lambda_not_dvd_z},
    $\lambda^{3n-2} \divides a+b$.
\end{proof}

\begin{lemma}
    \label{lmm:lambda_not_dvd_w}
    \lean{Solution.lambda_not_dvd_w}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\lambda \notdivides w$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:multiplicity_lambda_c_finite}
    By contradiction, if $\lambda \divides w$, then $\lambda^{n+1} \divides \lambda^n  w
    = c$ which is absurd by definition of multiplicity.
\end{proof}

\begin{lemma}
    \label{lmm:lambda_not_dvd_x}
    \lean{Solution.lambda_not_dvd_x}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\lambda \notdivides x$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_dvd_a_add_eta_mul_b, lmm:lambda_dvd_a_add_eta_sq_mul_b,
    lmm:cube_add_cube_eq_mul, lmm:Solution_two_le_multiplicity, lmm:lambda_prime,
    lmm:lambda_not_dvd_w, lmm:lambda_ne_zero}
    By contradiction, if $\lambda \divides x$, then
    $\lambda^{3n-1} \divides \lambda^{3n-2}  x = a+b$. Using \Cref{lmm:lambda_dvd_a_add_eta_mul_b}
    and \Cref{lmm:lambda_dvd_a_add_eta_sq_mul_b}, we have that $\lambda^{3n+1} \divides
    (a+b)  (a + \eta  b)  (a + \eta^2 cdot b) = a^3+b^3
    = u c^3 = u \lambda^{3n} w^3$.
    Then $\lambda \divides w^3$ which implies that $\lambda \divides w$
    which is absurd by \Cref{lmm:lambda_not_dvd_w}.
\end{proof}

\begin{lemma}
    \label{lmm:coprime_x_y}
    \lean{Solution.coprime_x_y}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\gcd(x, y) = 1$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_not_dvd_y, lmm:associated_of_dvd_a_add_b_of_dvd_a_add_eta_mul_b,
    lmm:lambda_not_dvd_x}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:coprime_x_z}
    \lean{Solution.coprime_x_z}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\gcd(x, z) = 1$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_not_dvd_z, lmm:associated_of_dvd_a_add_b_of_dvd_a_add_eta_sq__mul_b,
    lmm:lambda_not_dvd_x}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:coprime_y_z}
    \lean{Solution.coprime_y_z}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\gcd(y, z) = 1$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_not_dvd_z, lmm:associated_of_dvd_a_add_eta_mul_b_of_dvd_a_add_eta_sq__mul_b,
    lmm:lambda_not_dvd_y}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:mult_minus_two_plus_one_plus_one}
    \lean{Solution.mult_minus_two_plus_one_plus_one}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$ with multiplicity $n$.\\\\
    Then $3n - 2 + 1 + 1 = 3n$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:Solution_two_le_multiplicity}
    It directly follows from \Cref{lmm:Solution_two_le_multiplicity}
    and calculations using ring properties.
\end{proof}

\begin{lemma}
    \label{lmm:x_mul_y_mul_z_eq_u_w_pow_three}
    \lean{Solution.x_mul_y_mul_z_eq_u_w_pow_three}
    \leanok
    \uses{def:Solution}
    Let $S=(a,b,c,u)$ be a $solution$.\\\\
    Then $x y z = u w^3$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:Solution_two_le_multiplicity, lmm:lambda_ne_zero, lmm:cube_add_cube_eq_mul,
    def:Solution_x_y_z_w}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:x_eq_unit_mul_cube}
    \lean{Solution.x_eq_unit_mul_cube}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\exists u_1 \in \cc{O}^\times_K$ and $\exists X \in \cc{O}_K$
    such that $x = u_1 X^3$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:x_mul_y_mul_z_eq_u_w_pow_three, lmm:coprime_x_y, lmm:coprime_x_z}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:y_eq_unit_mul_cube}
    \lean{Solution.y_eq_unit_mul_cube}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\exists u_2 \in \cc{O}^\times_K$ and $\exists Y \in \cc{O}_K$
    such that $y = u_2 Y^3$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:x_mul_y_mul_z_eq_u_w_pow_three, lmm:coprime_x_y, lmm:coprime_y_z}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:z_eq_unit_mul_cube}
    \lean{Solution.z_eq_unit_mul_cube}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\exists u_3 \in \cc{O}^\times_K$ and $\exists Z \in \cc{O}_K$
    such that $z = u_3  Z^3$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:x_mul_y_mul_z_eq_u_w_pow_three, lmm:coprime_x_z, lmm:coprime_y_z}
    % TODO
\end{proof}

\begin{definition}[$u_1,u_2,u_3,u_4,u_5,X,Y,Z$]
    \label{def:Solution_u1_u2_u3_u4_u5_X_Y_Z}
    %\lean{}
    \leanok
    \uses{def:Solution, lmm:x_eq_unit_mul_cube,
    lmm:y_eq_unit_mul_cube, lmm:z_eq_unit_mul_cube}
    Let $S$ be a $solution$.\\\\
    We define $u_1 \in \cc{O}^\times_K$ and $X \in \cc{O}_K$
    such that $x = u_1 X^3$.\\
    We define $u_2 \in \cc{O}^\times_K$ and $Y \in \cc{O}_K$
    such that $y = u_2 Y^3$.\\
    We define $u_3 \in \cc{O}^\times_K$ and $Z \in \cc{O}_K$
    such that $z = u_3 Z^3$.\\
    We define $u_4 = \eta u_3 u_2^{-1}$.\\
    We define $u_5 = s-\eta^2 u_1 u_2^{-1}$.\\
\end{definition}

\begin{lemma}
    \label{lmm:X_ne_zero}
    \lean{Solution.X_ne_zero}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $X \neq 0$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{def:Solution_u1_u2_u3_u4_u5_X_Y_Z, lmm:lambda_not_dvd_x}
    By contradiction we assume that $X = 0$, then $x = 0$ by \Cref{def:Solution_u1_u2_u3_u4_u5_X_Y_Z}.
    Therefore $\lambda$ trivially divides $x$ (as any number divides zero) which contradicts
    \Cref{lmm:lambda_not_dvd_x} forcing us to conclude that $X \neq 0$.
\end{proof}

\begin{lemma}
    \label{lmm:lambda_not_dvd_X}
    \lean{Solution.lambda_not_dvd_X}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\lambda \notdivides X$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{def:Solution_u1_u2_u3_u4_u5_X_Y_Z,, lmm:lambda_not_dvd_x}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:lambda_not_dvd_Y}
    \lean{Solution.lambda_not_dvd_Y}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\lambda \notdivides Y$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_not_dvd_y}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:lambda_not_dvd_Z}
    \lean{Solution.lambda_not_dvd_Z}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\lambda \notdivides Z$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_not_dvd_z}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:coprime_Y_Z}
    \lean{Solution.coprime_Y_Z}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\gcd(Y, Z) = 1$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_not_dvd_Z, lmm:coprime_y_z}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:formula1}
    \lean{Solution.formula1}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$ with multiplicity $n$.\\\\
    Then $u_1 X^3 \lambda^{3n-2}+u_2 \eta Y^3 \lambda +
    u_3 \eta^2 Z^3 \lambda = 0$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{def:Solution_u1_u2_u3_u4_u5_X_Y_Z,
    lmm:toInteger_cube_eq_one, lmm:toInteger_eval_cyclo}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:u₄_isUnit}
    \lean{Solution.u₄'_isUnit}
    \leanok
    \uses{def:Solution, def:Solution_u1_u2_u3_u4_u5_X_Y_Z}
    Let $S$ be a $solution$.\\\\
    Then $u_4$ is a unit.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:eta_isUnit}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:u₅_isUnit}
    \lean{Solution.u₅'_isUnit}
    \leanok
    \uses{def:Solution, def:Solution_u1_u2_u3_u4_u5_X_Y_Z}
    Let $S$ be a $solution$.\\\\
    Then $u_5$ is a unit.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:toInteger_cube_eq_one}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:formula2}
    \lean{Solution.formula2}
    \leanok
    \uses{def:Solution, def:Solution_u1_u2_u3_u4_u5_X_Y_Z}
    Let $S$ be a $solution$ with multiplicity $n$.\\\\
    Then $Y^3 + u_4 Z^3 = u_5 (\lambda^(n-1) X)^3$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:eta_isUnit, lmm:lambda_ne_zero, lmm:toInteger_cube_eq_one,
    lmm:Solution_two_le_multiplicity, lmm:formula1}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:lambda_sq_div_lambda_fourth}
    \lean{Solution.lambda_sq_div_lambda_fourth}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $\lambda^2 \divides \lambda^4$.
\end{lemma}
\begin{proof}
    \leanok
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:lambda_sq_div_new_X_cubed}
    \lean{Solution.lambda_sq_div_new_X_cubed}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$ with multiplicity $n$.\\\\
    Then $\lambda^2 \divides u_5 (\lambda^{n - 1} X)^3$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:Solution_two_le_multiplicity}
    % TODO
\end{proof}

\begin{lemma}[Kummer]
    \label{lmm:by_kummer}
    \lean{Solution.by_kummer}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$.\\\\
    Then $u_4 \in \set{-1,1} \subset \cc{O}_K$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_sq_div_lambda_fourth, lmm:lambda_sq_div_new_X_cubed,
    lmm:eq_one_or_neg_one_of_unit_of_congruent,
    lmm:lambda_pow_four_dvd_cube_sub_one_or_add_one_of_lambda_not_dvd,
    lmm:lambda_not_dvd_Z, lmm:formula2}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:final}
    \lean{Solution.final}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$ with multiplicity $n$.\\\\
    Then $Y^3 + (u_4 Z)^3 = u_5 (\lambda^{n-1} X)^3$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:formula2, lmm:by_kummer}
    % TODO
\end{proof}

\begin{definition}[Final Solution']
    \label{def:Solution1_final}
    \lean{Solution'_final}
    \leanok
    \uses{def:Solution1, lmm:Solution_two_le_multiplicity,
    lmm:final, lmm:coprime_Y_Z, lmm:lambda_not_dvd_Y, lmm:lambda_not_dvd_Z, lmm:lambda_ne_zero,
    lmm:X_ne_zero}
    Let $S = (a,b,c,u)$ be a $solution$ with multiplicity $n$.\\
    Let $S_f' = (Y,u_4 Z, \lambda^{n-1} X, u_5)$.\\\\
    Then $S_f'$ is a $solution'$.
\end{definition}

\begin{lemma}
    \label{lmm:Solution1_final_multiplicity}
    \lean{Solution'_final_multiplicity}
    \leanok
    \uses{def:Solution, def:Solution1_final}
    Let $S$ be a $solution$ with multiplicity $n$.\\\\
    Then $S_f'$ has multiplicity $n-1$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:lambda_not_dvd_X,
    lmm:lambda_ne_zero}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:Solution1_final_multiplicity_lt}
    \lean{Solution'_final_multiplicity_lt}
    \leanok
    \uses{def:Solution, def:Solution1_final}
    Let $S$ be a $solution$ with multiplicity $n$.\\\\
    Then $S_f'$ has multiplicity $m<n$.
\end{lemma}
\begin{proof}
    \leanok
    \uses{lmm:Solution1_final_multiplicity, lmm:Solution_two_le_multiplicity}
    % TODO
\end{proof}

\begin{theorem}
    \label{lmm:exists_Solution_multiplicity_lt}
    \lean{Solution.exists_Solution_multiplicity_lt}
    \leanok
    \uses{def:Solution}
    Let $S$ be a $solution$ with multiplicity $n$.\\\\
    Then there is a $solution$ with multiplicity $m<n$.
\end{theorem}
\begin{proof}
    \leanok
    \uses{lmm:exists_Solution_of_Solution1, lmm:Solution1_final_multiplicity_lt}
    % TODO
\end{proof}

\begin{theorem}[Generalised Fermat's Last Theorem for Exponent $3$]
    \label{thm:fermatLastTheoremForThreeGen}
    \lean{fermatLastTheoremForThreeGen}
    \leanok
    Let $a, b, c \in \cc{O}_K$ such that $c \neq 0$ and $\gcd(a,b)=1$. \\
    Let $\lambda \notdivides a$, $\lambda \notdivides b$ and $\lambda \divides c$. \\\\
    Then $a^3 + b^3 \neq u c^3$.
\end{theorem}
\begin{proof}
    \leanok
    \uses{lmm:exists_Solution_of_Solution1,
    lmm:exists_minimal,
    lmm:exists_Solution_multiplicity_lt}
    % TODO
\end{proof}

\begin{lemma}
    \label{lmm:FermatLastTheoremForThree_of_FermatLastTheoremThreeGen}
    \lean{FermatLastTheoremForThree_of_FermatLastTheoremThreeGen}
    \leanok
    To prove \Cref{thm:fermatLastTheoremThree},
    it suffices to prove \Cref{thm:fermatLastTheoremForThreeGen}. \\
    Equivalently, \Cref{thm:fermatLastTheoremForThreeGen} implies
    \Cref{thm:fermatLastTheoremThree}.
\end{lemma}
\begin{proof}
    \leanok
    \uses{
    thm:fermatLastTheoremThree_of_three_dvd_only_c,
    lmm:norm_lambda_prime,
    lmm:norm_lambda,
    lmm:lambda_dvd_three}
    % TODO
\end{proof}